---
phase: 02-script-editor
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/sidebar/Sidebar.tsx
  - src/components/sidebar/FolderItem.tsx
  - src/components/sidebar/ScriptItem.tsx
  - src/components/sidebar/SidebarToolbar.tsx
autonomous: true

must_haves:
  truths:
    - "User can see folders and scripts in a left sidebar tree"
    - "User can create new scripts and folders via toolbar buttons"
    - "User can delete scripts and folders via right-click context menu"
    - "User can rename scripts and folders via right-click context menu"
    - "User can drag scripts to reorder within folders and move between folders"
    - "Each script entry shows title and a 1-2 line content preview"
    - "Clicking a script selects it as the active script"
  artifacts:
    - path: "src/components/sidebar/Sidebar.tsx"
      provides: "Root sidebar component with DnD context and folder list"
      exports: ["Sidebar"]
    - path: "src/components/sidebar/FolderItem.tsx"
      provides: "Collapsible folder with sortable script list"
      exports: ["FolderItem"]
    - path: "src/components/sidebar/ScriptItem.tsx"
      provides: "Individual script entry with title, preview, and context menu"
      exports: ["ScriptItem"]
    - path: "src/components/sidebar/SidebarToolbar.tsx"
      provides: "Toolbar with + buttons for new script and new folder"
      exports: ["SidebarToolbar"]
  key_links:
    - from: "src/components/sidebar/Sidebar.tsx"
      to: "src/stores/scriptStore.ts"
      via: "useScriptStore for folders, scripts, CRUD actions"
      pattern: "useScriptStore"
    - from: "src/components/sidebar/Sidebar.tsx"
      to: "@dnd-kit/core"
      via: "DndContext wrapping the folder list"
      pattern: "DndContext"
    - from: "src/components/sidebar/FolderItem.tsx"
      to: "@dnd-kit/sortable"
      via: "SortableContext for scripts within each folder"
      pattern: "SortableContext"
    - from: "src/components/sidebar/ScriptItem.tsx"
      to: "@dnd-kit/sortable"
      via: "useSortable hook for drag handle"
      pattern: "useSortable"
---

<objective>
Build the left sidebar file tree with folders, scripts, CRUD operations, and drag-and-drop reordering.

Purpose: The sidebar is how users organize their teleprompter scripts. It should feel like Apple Notes -- folders with scripts inside, draggable to reorder, right-click for operations.
Output: Sidebar, FolderItem, ScriptItem, and SidebarToolbar components ready to be placed into the layout in Plan 04.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-script-editor/02-CONTEXT.md
@.planning/phases/02-script-editor/02-RESEARCH.md
@.planning/phases/02-script-editor/02-01-SUMMARY.md

@src/components/ui/GlassPanel.tsx
@src/styles/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SidebarToolbar, ScriptItem, and FolderItem components</name>
  <files>
    src/components/sidebar/SidebarToolbar.tsx
    src/components/sidebar/ScriptItem.tsx
    src/components/sidebar/FolderItem.tsx
  </files>
  <action>
    1. Create `src/components/sidebar/SidebarToolbar.tsx` with ABOUTME comment. Implement:
       - A horizontal toolbar at the top of the sidebar.
       - Two buttons: "+" for new script (document icon or label), "folder +" for new folder.
       - New script button: Calls `useScriptStore.getState().createScript(folderId, 'Untitled')`. If no folders exist, create a default "Scripts" folder first, then create the script in it.
       - New folder button: Calls `useScriptStore.getState().createFolder('New Folder')`.
       - Styling: small icon-style buttons, white/60 text, hover to white/80, consistent with dark glassmorphic theme. Use simple unicode or SVG icons (no icon library needed).

    2. Create `src/components/sidebar/ScriptItem.tsx` with ABOUTME comment. Implement:
       - Props: `id: string`, `title: string`, `preview: string`, `isActive: boolean`
       - Uses `useSortable({ id })` from `@dnd-kit/sortable` for drag-and-drop.
       - Apply transform and transition styles from useSortable via `CSS.Transform.toString(transform)` from `@dnd-kit/utilities`.
       - Renders: title (truncated, white/90, font-medium, text-sm) and preview snippet (truncated, white/40, text-xs) in a vertical stack.
       - Active state: highlighted background (white/10) to indicate the currently selected script.
       - Click handler: Calls `useScriptStore.getState().setActiveScript(id)`.
       - Right-click context menu: Use a simple custom context menu (not a library). On right-click, show a small absolutely-positioned menu with "Rename" and "Delete" options.
         - Rename: Switch to an inline text input for the title. On Enter or blur, call `renameScript(id, newTitle)`.
         - Delete: Call `deleteScript(id)` with a simple confirmation (window.confirm is acceptable for now).
       - Close context menu on click outside or Escape key.

    3. Create `src/components/sidebar/FolderItem.tsx` with ABOUTME comment. Implement:
       - Props: `folder: Folder`, `scripts: ScriptMeta[]`, `activeScriptId: string | null`
       - Collapsible: Click folder header to toggle `isCollapsed` state (stored in the Folder object in scriptStore, update via a `toggleFolderCollapse(folderId)` action -- add this to scriptStore if not present, or manage locally).
       - Folder header: Shows folder name (white/70, uppercase text-xs tracking-wider or similar) and a collapse/expand chevron indicator.
       - Right-click context menu on folder header: "Rename" and "Delete" options.
         - Rename: Inline text input, on Enter/blur calls `renameFolder(folderId, newName)`.
         - Delete: Calls `deleteFolder(folderId)` with confirmation.
       - When expanded, renders a `SortableContext` (from `@dnd-kit/sortable`) wrapping the list of ScriptItem components for this folder. Use `verticalListSortingStrategy`.
       - The SortableContext's `items` prop should be the array of script IDs in this folder (sorted by order).
       - Generate the preview snippet for each script: first 80 characters of content with markdown syntax stripped (simple regex to remove #, *, **, _, etc.), or "No content" if empty.
  </action>
  <verify>
    - `npm run typecheck` passes
    - All three files export their named components
    - No `any` types used
  </verify>
  <done>SidebarToolbar provides creation buttons, ScriptItem renders draggable script entries with context menus, FolderItem renders collapsible folders with sortable script lists.</done>
</task>

<task type="auto">
  <name>Task 2: Create Sidebar root with DnD context and cross-folder drag</name>
  <files>src/components/sidebar/Sidebar.tsx</files>
  <action>
    Create `src/components/sidebar/Sidebar.tsx` with ABOUTME comment ("Root sidebar component providing drag-and-drop context and folder/script tree").

    Component behavior:
    - Reads `folders`, `scripts`, `activeScriptId`, `reorderScripts`, `moveScript` from `useScriptStore`.
    - Wraps the entire sidebar content in a `DndContext` from `@dnd-kit/core`.
    - Layout (top to bottom):
      1. SidebarToolbar at the top
      2. Scrollable area containing FolderItem components for each folder (sorted by folder.order)
    - DnD handlers:
      - `onDragOver`: When a script is dragged over a different folder's SortableContext, call `moveScript(scriptId, targetFolderId)` to transfer it. Use the `over` event data to determine the target container.
      - `onDragEnd`: When a script is dropped within the same folder, use `arrayMove` from `@dnd-kit/sortable` to compute the new order and call `reorderScripts(folderId, newScriptIds)`.
      - Use `closestCenter` collision detection from `@dnd-kit/core`.
    - Use `DragOverlay` to render a styled drag preview (a semi-transparent clone of the ScriptItem being dragged).
    - Manage `activeId` state (which item is being dragged) via `onDragStart` / `onDragEnd`.
    - Styling: Full height, dark glassmorphic background (use bg-white/5 or similar, matching the overall dark aesthetic). Overflow-y auto on the folder list area. Subtle border-right (white/10) to separate from editor.
    - If no folders exist, show an empty state prompting user to create a folder ("Click + to create your first script").

    Important: Each folder's scripts should be filtered from the full scripts array by `folderId` and sorted by `order`. Pass these filtered/sorted scripts to each FolderItem.
  </action>
  <verify>
    - `npm run typecheck` passes
    - `npm run lint` passes
    - `npm run check:all` passes
    - Sidebar component exports correctly
    - DndContext wraps the folder tree
    - Cross-folder drag is handled via onDragOver
  </verify>
  <done>Sidebar root component provides DnD context for the entire file tree. Scripts can be reordered within folders and dragged between folders. The sidebar is ready to be placed in the three-panel layout.</done>
</task>

</tasks>

<verification>
- `npm run check:all` passes
- Four new files exist: Sidebar.tsx, FolderItem.tsx, ScriptItem.tsx, SidebarToolbar.tsx
- No `any` types used
- DnD context properly wraps the folder tree
- Context menus work for rename and delete operations
- Each FolderItem has its own SortableContext
</verification>

<success_criteria>
The sidebar is a self-contained, importable component tree that renders folders and scripts, supports CRUD via toolbar and context menus, and allows drag-and-drop reordering. Ready to be placed into the three-panel layout in Plan 04.
</success_criteria>

<output>
After completion, create `.planning/phases/02-script-editor/02-03-SUMMARY.md`
</output>
