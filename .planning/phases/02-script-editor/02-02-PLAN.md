---
phase: 02-script-editor
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/editor/editorTheme.ts
  - src/components/editor/editorExtensions.ts
  - src/components/editor/ScriptEditor.tsx
autonomous: true

must_haves:
  truths:
    - "User can type raw markdown in the editor and see syntax highlighting"
    - "Switching scripts shows the correct content without stale data"
    - "Content auto-saves to disk after ~1 second of inactivity"
    - "Editor has a distraction-free, notes-app appearance (no line numbers, no gutters)"
  artifacts:
    - path: "src/components/editor/editorTheme.ts"
      provides: "Custom dark CodeMirror theme with sans-serif font"
      exports: ["steadiEditorTheme", "steadiHighlightStyle"]
    - path: "src/components/editor/editorExtensions.ts"
      provides: "Bundled CM6 extensions for markdown editing"
      exports: ["steadiExtensions"]
    - path: "src/components/editor/ScriptEditor.tsx"
      provides: "CodeMirror editor component with auto-save debounce"
      exports: ["ScriptEditor"]
  key_links:
    - from: "src/components/editor/ScriptEditor.tsx"
      to: "src/stores/scriptStore.ts"
      via: "useScriptStore hook for content and activeScriptId"
      pattern: "useScriptStore"
    - from: "src/components/editor/ScriptEditor.tsx"
      to: "src/persistence/scriptFiles.ts"
      via: "debounced save callback"
      pattern: "saveScriptContent|saveActiveContent"
---

<objective>
Build the CodeMirror 6 markdown editor with a custom dark theme, distraction-free configuration, and auto-save functionality.

Purpose: The editor is the core writing surface where users compose teleprompter scripts. It must feel like a polished notes app, not a code editor.
Output: ScriptEditor component with custom theme, markdown syntax highlighting, and debounced auto-save wired to the persistence layer from Plan 01.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-script-editor/02-CONTEXT.md
@.planning/phases/02-script-editor/02-RESEARCH.md
@.planning/phases/02-script-editor/02-01-SUMMARY.md

@src/styles/globals.css
@src/components/ui/GlassPanel.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create custom dark theme and extensions bundle</name>
  <files>
    src/components/editor/editorTheme.ts
    src/components/editor/editorExtensions.ts
  </files>
  <action>
    1. Create `src/components/editor/editorTheme.ts` with ABOUTME comment ("Custom dark CodeMirror 6 theme for the Steadi script editor"). Implement:
       - `steadiEditorTheme`: An `EditorView.theme()` with `{ dark: true }` option. Style:
         - `&`: transparent background, white/85 text color, sans-serif font family (`"Inter", "SF Pro Text", -apple-system, sans-serif`), 16px font size, 1.7 line height
         - `.cm-content`: white caret, padding 24px 32px, inherit font family
         - `&.cm-focused .cm-cursor`: white border-left, 2px width
         - `&.cm-focused .cm-selectionBackground, ::selection`: white/15 background
         - `.cm-selectionBackground`: white/10 background
         - `.cm-activeLine`: white/3 background (very subtle)
         - `.cm-scroller`: overflow auto
         - `.cm-gutters`: display none (hide gutters for distraction-free editing)
       - `steadiHighlightStyle`: A `syntaxHighlighting(HighlightStyle.define([...]))` with markdown-appropriate styles:
         - heading1: white, bold, 1.4em
         - heading2: white, bold, 1.2em
         - heading3: white, bold, 1.1em
         - emphasis: white/85, italic
         - strong: white, bold
         - link: soft blue (rgba(130,170,255,0.9)), underline
         - url: soft blue/70
         - quote: white/50, italic
         - monospace: warm orange (rgba(255,200,120,0.9))
         - processingInstruction (markdown syntax chars): white/30 (de-emphasized)
       Import `EditorView` from `@codemirror/view`, `HighlightStyle, syntaxHighlighting` from `@codemirror/language`, `tags` from `@lezer/highlight`.

    2. Create `src/components/editor/editorExtensions.ts` with ABOUTME comment ("Bundled CodeMirror 6 extensions for markdown editing in Steadi"). Implement:
       - Export `steadiExtensions`: An array of CM6 extensions combining:
         - `markdown()` from `@codemirror/lang-markdown`
         - `EditorView.lineWrapping` for soft line wrapping (prose, not code)
         - `steadiHighlightStyle` from `./editorTheme`
       - This array is passed to the CodeMirror component's `extensions` prop.
  </action>
  <verify>
    - `npm run typecheck` passes
    - Both files export their named exports correctly
  </verify>
  <done>Custom dark theme with sans-serif font and markdown syntax highlighting is defined. Extensions bundle includes markdown language support and line wrapping.</done>
</task>

<task type="auto">
  <name>Task 2: Create ScriptEditor component with auto-save</name>
  <files>src/components/editor/ScriptEditor.tsx</files>
  <action>
    Create `src/components/editor/ScriptEditor.tsx` with ABOUTME comment ("CodeMirror-based markdown editor with debounced auto-save for teleprompter scripts").

    Component behavior:
    - Reads `activeScriptId`, `activeContent`, `setContent`, `saveActiveContent` from `useScriptStore`.
    - Renders a CodeMirror editor using `@uiw/react-codemirror`:
      - `key={activeScriptId}` to force remount on script switch (prevents stale editor state -- see Pitfall 2 in research).
      - `value={activeContent}`
      - `theme={steadiEditorTheme}` (custom theme from editorTheme.ts)
      - `extensions={steadiExtensions}` (from editorExtensions.ts)
      - `basicSetup` configured: lineNumbers: false, foldGutter: false, highlightActiveLine: true, bracketMatching: false, closeBrackets: false, autocompletion: false, highlightSelectionMatches: false, searchKeymap: true
      - `onChange` handler that calls `setContent(value)` and triggers debounced save
    - Auto-save debounce: Use a `useRef` for the timeout. On each onChange:
      1. Call `setContent(value)` immediately (updates Zustand in-memory state)
      2. Clear any existing timeout
      3. Set a new timeout for 1000ms that calls `saveActiveContent()`
    - Cleanup: Clear timeout on unmount via useEffect cleanup.
    - Override `user-select` on the editor container: The global CSS sets `user-select: none`. Apply `[&_.cm-editor]:select-text` and `[&_.cm-editor_*]:select-text` Tailwind classes on the wrapper div, OR add a style override. The user MUST be able to select text in the editor. This is critical (see Pitfall 6 in research).
    - When there is no active script (activeScriptId is null), show an empty state: centered text "Select or create a script to start writing" in white/40 color.
    - The component should fill its parent container height (`h-full`).
  </action>
  <verify>
    - `npm run typecheck` passes
    - `npm run lint` passes
    - `npm run check:all` passes
    - The component exports `ScriptEditor` as a named export
  </verify>
  <done>ScriptEditor component renders a distraction-free CodeMirror markdown editor with auto-save. Switching scripts forces a clean remount. Text selection works despite the global user-select:none. Empty state shown when no script is selected.</done>
</task>

</tasks>

<verification>
- `npm run check:all` passes
- Three new files exist: editorTheme.ts, editorExtensions.ts, ScriptEditor.tsx
- No `any` types used
- Editor uses `key={activeScriptId}` for clean script switching
- Auto-save debounce timeout is 1000ms
- User-select override is applied to the editor container
</verification>

<success_criteria>
The ScriptEditor component is a self-contained, importable unit that renders a dark-themed CodeMirror markdown editor. It reads from and writes to the Zustand script store, auto-saves content to disk after 1 second of inactivity, and handles script switching cleanly. Ready to be placed into the three-panel layout in Plan 04.
</success_criteria>

<output>
After completion, create `.planning/phases/02-script-editor/02-02-SUMMARY.md`
</output>
